import{f as U,n as I,c as i,a as t,d as S,q as C,h as g,v as V,i as a,b as A,s as L,k as x,j as N,F as v,m as j,_ as M,u as R,o as d}from"./index-CPAmuxyc.js";import{a as B}from"./api-BEEHNiEv.js";const E={class:"bg-gray-50 py-16 sm:py-20"},F={class:"mx-auto max-w-4xl px-6 lg:px-8"},D={class:"rounded-2xl border border-gray-200 bg-white p-6 shadow-sm sm:p-8"},O={class:"grid gap-6 sm:grid-cols-2"},Q=["value"],T={key:0,class:"mt-4 grid grid-cols-1 gap-3 sm:grid-cols-2"},X=["src","alt"],P=U({__name:"NewsletterWrite",setup(_){const u=R(),s=I(),b=a(null),l=a({category:"",title:"",description:"",images:[]}),n=a([]),m=a(!1),c=a(""),p=o=>{c.value=o,m.value=!0},f=()=>{m.value=!1},y=()=>{const o=Array.from(b.value?.files??[]);l.value.images=o,n.value.forEach(e=>URL.revokeObjectURL(e)),n.value=o.map(e=>URL.createObjectURL(e))},w=()=>{u.push("/newsletter")},k=()=>{if(!l.value.category||!l.value.title.trim()||!l.value.description.trim()){p("필수값을 입력하세요.");return}if(!s.isLogin||!s.memberId||!s.username)return p("로그인 정보가 없습니다. 다시 로그인해 주세요."),u.push("/login");const o=new FormData;o.append("memberId",String(s.memberId)),o.append("username",String(s.username)),o.append("category",l.value.category),o.append("title",l.value.title.trim()),o.append("description",l.value.description.trim()),l.value.images.forEach(e=>{o.append("images",e,e.name)}),B("/api/newsletter/write",{method:"POST",body:o}).then(e=>{if(!e.ok)throw new Error("저장 실패");u.push("/newsletter")}).catch(e=>{console.error(e),p("오류가 발생했습니다.")})};return(o,e)=>(d(),i(v,null,[t("div",E,[t("div",F,[e[11]||(e[11]=t("div",{class:"mb-10"},[t("h2",{class:"text-3xl font-semibold tracking-tight text-gray-900 sm:text-4xl"}," 카드 작성 "),t("p",{class:"mt-2 text-sm text-gray-500"}," 카드에 표시될 내용을 입력하세요. ")],-1)),t("div",D,[t("form",{onSubmit:C(k,["prevent"]),class:"space-y-6"},[t("div",O,[t("div",null,[e[4]||(e[4]=t("label",{class:"block text-sm font-medium text-gray-700"},"카테고리",-1)),g(t("select",{"onUpdate:modelValue":e[0]||(e[0]=r=>l.value.category=r),class:"mt-2 block w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 focus:border-blue-400 focus:ring-blue-200"},[...e[3]||(e[3]=[A('<option value="">선택</option><option value="UI/UX 이슈">UI/UX 이슈</option><option value="QA 증빙">QA 증빙</option><option value="인프라 / 설정 공유">인프라 / 설정 공유</option><option value="운영 이슈">운영 이슈</option>',5)])],512),[[V,l.value.category]])]),t("div",null,[e[5]||(e[5]=t("label",{class:"block text-sm font-medium text-gray-700"},"작성자",-1)),t("input",{type:"text",value:L(s).username||"",readonly:"",class:"mt-2 block w-full rounded-md border border-gray-200 bg-gray-50 px-3 py-2 text-sm text-gray-700",placeholder:"로그인 필요"},null,8,Q)])]),t("div",null,[e[6]||(e[6]=t("label",{class:"block text-sm font-medium text-gray-700"},"제목",-1)),g(t("input",{"onUpdate:modelValue":e[1]||(e[1]=r=>l.value.title=r),type:"text",class:"mt-2 block w-full rounded-md border border-gray-300 px-3 py-2 text-sm text-gray-900 focus:border-blue-400 focus:ring-blue-200",placeholder:"제목을 입력하세요"},null,512),[[x,l.value.title]]),e[7]||(e[7]=t("p",{class:"mt-2 text-xs text-gray-500"}," 입력한 제목은 업로드한 이미지 파일명으로 사용됩니다. ",-1))]),t("div",null,[e[8]||(e[8]=t("label",{class:"block text-sm font-medium text-gray-700"},"요약",-1)),g(t("textarea",{"onUpdate:modelValue":e[2]||(e[2]=r=>l.value.description=r),rows:"4",class:"mt-2 block w-full rounded-md border border-gray-300 px-3 py-2 text-sm text-gray-900 focus:border-blue-400 focus:ring-blue-200",placeholder:"카드에 노출될 요약 내용을 입력하세요"},null,512),[[x,l.value.description]])]),t("div",null,[e[9]||(e[9]=t("label",{class:"block text-sm font-medium text-gray-700"},"이미지",-1)),t("input",{ref_key:"imageInput",ref:b,type:"file",accept:"image/*",class:"mt-2 block w-full rounded-md border border-gray-300 px-3 py-2 text-sm text-gray-700 file:mr-4 file:rounded-md file:border-0 file:bg-blue-50 file:px-4 file:py-2 file:text-sm file:font-semibold file:text-blue-600 hover:file:bg-blue-100",onChange:y,multiple:""},null,544),n.value.length>0?(d(),i("div",T,[(d(!0),i(v,null,j(n.value,(r,h)=>(d(),i("div",{key:r,class:"overflow-hidden rounded-xl border border-gray-200"},[t("img",{src:r,alt:`미리보기-${h+1}`,class:"h-48 w-full object-cover"},null,8,X)]))),128))])):N("",!0)]),t("div",{class:"flex justify-end gap-3 pt-2"},[t("button",{type:"button",class:"rounded-md border border-gray-300 px-4 py-2 text-sm font-semibold text-gray-700 hover:bg-gray-50",onClick:w}," 취소 "),e[10]||(e[10]=t("button",{type:"submit",class:"rounded-md bg-blue-500 px-6 py-2 text-sm font-semibold text-white hover:bg-blue-600"}," 저장 ",-1))])],32)])])]),S(M,{open:m.value,title:"알림",message:c.value,"show-cancel":!1,"confirm-text":"확인",onClose:f,onConfirm:f},null,8,["open","message"])],64))}});export{P as default};
