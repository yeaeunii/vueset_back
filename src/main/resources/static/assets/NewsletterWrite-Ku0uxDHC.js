import{f as U,n as C,c as i,a as t,d as S,q as I,h as c,v as L,i as a,s as V,k as x,j,F as v,m as M,_ as N,u as R,o as d}from"./index-DVDskhOi.js";const A={class:"bg-gray-50 py-16 sm:py-20"},B={class:"mx-auto max-w-4xl px-6 lg:px-8"},E={class:"rounded-2xl border border-gray-200 bg-white p-6 shadow-sm sm:p-8"},_={class:"grid gap-6 sm:grid-cols-2"},D=["value"],F={key:0,class:"mt-4 grid grid-cols-1 gap-3 sm:grid-cols-2"},O=["src","alt"],q=U({__name:"NewsletterWrite",setup(T){const u=R(),l=C(),g=a(null),r=a({category:"",title:"",description:"",images:[]}),n=a([]),m=a(!1),f=a(""),p=s=>{f.value=s,m.value=!0},b=()=>{m.value=!1},y=()=>{const s=Array.from(g.value?.files??[]);r.value.images=s,n.value.forEach(e=>URL.revokeObjectURL(e)),n.value=s.map(e=>URL.createObjectURL(e))},w=()=>{u.push("/newsletter")},k=()=>{if(!r.value.category||!r.value.title.trim()||!r.value.description.trim()){p("필수값을 입력하세요.");return}if(!l.isLogin||!l.memberId||!l.username)return p("로그인 정보가 없습니다. 다시 로그인해 주세요."),u.push("/login");const s=new FormData;s.append("memberId",String(l.memberId)),s.append("username",String(l.username)),s.append("category",r.value.category),s.append("title",r.value.title.trim()),s.append("description",r.value.description.trim()),r.value.images.forEach(e=>{s.append("images",e)}),fetch("/api/newsletter/write",{method:"POST",body:s}).then(e=>{if(!e.ok)throw new Error("저장 실패");u.push("/newsletter")}).catch(e=>{console.error(e),p("오류가 발생했습니다.")})};return(s,e)=>(d(),i(v,null,[t("div",A,[t("div",B,[e[10]||(e[10]=t("div",{class:"mb-10"},[t("h2",{class:"text-3xl font-semibold tracking-tight text-gray-900 sm:text-4xl"}," 업데이트 작성 "),t("p",{class:"mt-2 text-sm text-gray-500"}," 업데이트 카드에 표시될 내용을 입력하세요. ")],-1)),t("div",E,[t("form",{onSubmit:I(k,["prevent"]),class:"space-y-6"},[t("div",_,[t("div",null,[e[4]||(e[4]=t("label",{class:"block text-sm font-medium text-gray-700"},"카테고리",-1)),c(t("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>r.value.category=o),class:"mt-2 block w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 focus:border-rose-400 focus:ring-rose-200"},[...e[3]||(e[3]=[t("option",{value:""},"선택",-1),t("option",{value:"릴리즈"},"릴리즈",-1),t("option",{value:"운영 리포트"},"운영 리포트",-1),t("option",{value:"공지 사항"},"공지 사항",-1)])],512),[[L,r.value.category]])]),t("div",null,[e[5]||(e[5]=t("label",{class:"block text-sm font-medium text-gray-700"},"작성자",-1)),t("input",{type:"text",value:V(l).username||"",readonly:"",class:"mt-2 block w-full rounded-md border border-gray-200 bg-gray-50 px-3 py-2 text-sm text-gray-700",placeholder:"로그인 필요"},null,8,D)])]),t("div",null,[e[6]||(e[6]=t("label",{class:"block text-sm font-medium text-gray-700"},"제목",-1)),c(t("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>r.value.title=o),type:"text",class:"mt-2 block w-full rounded-md border border-gray-300 px-3 py-2 text-sm text-gray-900 focus:border-rose-400 focus:ring-rose-200",placeholder:"업데이트 제목을 입력하세요"},null,512),[[x,r.value.title]])]),t("div",null,[e[7]||(e[7]=t("label",{class:"block text-sm font-medium text-gray-700"},"요약",-1)),c(t("textarea",{"onUpdate:modelValue":e[2]||(e[2]=o=>r.value.description=o),rows:"4",class:"mt-2 block w-full rounded-md border border-gray-300 px-3 py-2 text-sm text-gray-900 focus:border-rose-400 focus:ring-rose-200",placeholder:"카드에 노출될 요약을 입력하세요"},null,512),[[x,r.value.description]])]),t("div",null,[e[8]||(e[8]=t("label",{class:"block text-sm font-medium text-gray-700"},"이미지",-1)),t("input",{ref_key:"imageInput",ref:g,type:"file",accept:"image/*",class:"mt-2 block w-full rounded-md border border-gray-300 px-3 py-2 text-sm text-gray-700 file:mr-4 file:rounded-md file:border-0 file:bg-rose-50 file:px-4 file:py-2 file:text-sm file:font-semibold file:text-rose-600 hover:file:bg-rose-100",onChange:y,multiple:""},null,544),n.value.length>0?(d(),i("div",F,[(d(!0),i(v,null,M(n.value,(o,h)=>(d(),i("div",{key:o,class:"overflow-hidden rounded-xl border border-gray-200"},[t("img",{src:o,alt:`미리보기-${h+1}`,class:"h-48 w-full object-cover"},null,8,O)]))),128))])):j("",!0)]),t("div",{class:"flex justify-end gap-3 pt-2"},[t("button",{type:"button",class:"rounded-md border border-gray-300 px-4 py-2 text-sm font-semibold text-gray-700 hover:bg-gray-50",onClick:w}," 취소 "),e[9]||(e[9]=t("button",{type:"submit",class:"rounded-md bg-rose-500 px-6 py-2 text-sm font-semibold text-white hover:bg-rose-600"}," 저장 ",-1))])],32)])])]),S(N,{open:m.value,title:"알림",message:f.value,"show-cancel":!1,"confirm-text":"확인",onClose:b,onConfirm:b},null,8,["open","message"])],64))}});export{q as default};
